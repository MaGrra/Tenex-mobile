import { useEffect, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Select, SelectTrigger, SelectContent, SelectItem } from "@/components/ui/select";

const SHEETS = [
  { name: "Kopvērtējums", url: "https://docs.google.com/spreadsheets/d/1vGwEZFF1CQug9Zu-lolmuZ7ZMH5hLOklmYTydHhktaw/pub?output=csv&gid=0" },
  { name: "Rodeo", url: "https://docs.google.com/spreadsheets/d/1GRv7i8FD7Ergscl2znh7MkmootGrzVgSx2i1QJDpoiY/pub?output=csv&gid=0" },
  { name: "Kannu turēšana", url: "https://docs.google.com/spreadsheets/d/1SLgcLEFkvzDaTtQMb8UFoRMDnZSExvLN_wwiNjfwlnc/pub?output=csv&gid=0" },
  { name: "Futbola sitieni", url: "https://docs.google.com/spreadsheets/d/102Hxs4Ae-ZNml0tGS3NFCi0lQvJ7I2deeeNQR2Crz9s/pub?output=csv&gid=0" },
  { name: "Riņķis uz āķa", url: "https://docs.google.com/spreadsheets/d/1jokyEEJULQn_0ysiMpLp961rP5ilc-d_5ilPw0Mgjo0/pub?output=csv&gid=0" },
  { name: "Bungas", url: "https://docs.google.com/spreadsheets/d/1Rf5yQxaDOvrLI-d13U9E3h0LgPc5CAEVnALtkEhZ_Us/pub?output=csv&gid=0" },
  { name: "Pakavu kalšana", url: "https://docs.google.com/spreadsheets/d/104x2Vhi2fvGm1osQlM3EL2QGaKLfC1Sfq4phakIsRO0/pub?output=csv&gid=0" },
  { name: "Milzu koferis", url: "https://docs.google.com/spreadsheets/d/1fTevBQl8cf6nPYj8WWmCscjK__6Y03vei3GGXfvp_9I/pub?output=csv&gid=0" },
  { name: "Lielais metiens", url: "https://docs.google.com/spreadsheets/d/1BmPzOrS7vOc_IiZSTRRJv_sIEm7xcBFT6qjZMkp0PPE/pub?output=csv&gid=0" }
];

// Map team name prefixes to border colors
const TEAM_COLORS = {
  "Baltās": "#FFFFFF",      // Baltās krāsas komanda
  "Mint": "#AAF0D1",        // Mint krāsas komanda
  "Tirkīza": "#40E0D0",     // Tirkīza krāsas komanda
  "Persiku": "#FFDAB9"      // Persiku krāsas komanda
};

export default function ResultsMobile() {
  const [selectedSheet, setSelectedSheet] = useState(SHEETS[0]);
  const [teams, setTeams] = useState([]);

  const fetchData = async () => {
    const res = await fetch(selectedSheet.url);
    const csv = await res.text();
    const rows = csv.trim().split("\n").slice(1);
    const parsed = rows.map(r => r.split(","));

    const newData = parsed.map(r => ({
      name: r[0],
      score: parseFloat(r[1])
    })).filter(r => r.name && !isNaN(r.score));

    newData.sort((a, b) => b.score - a.score);
    setTeams(newData);
  };

  useEffect(() => {
    fetchData();
    const interval = setInterval(fetchData, 10000);
    return () => clearInterval(interval);
  }, [selectedSheet]);

  return (
    <div className="min-h-screen p-4 pt-20 bg-white">
      <div className="text-center text-3xl font-bold mb-1" style={{ fontFamily: 'Poppins' }}>Rezultāti</div>
      <div className="text-center text-sm text-gray-600 mb-4" style={{ fontFamily: 'Poppins' }}>Izvēlies disciplīnu</div>
      <div className="max-w-xs mx-auto mb-4">
        <Select onValueChange={value => {
          const s = SHEETS.find(s => s.name === value);
          if (s) setSelectedSheet(s);
        }}>
          <SelectTrigger>{selectedSheet.name}</SelectTrigger>
          <SelectContent>
            {SHEETS.map(sheet => (
              <SelectItem key={sheet.name} value={sheet.name}>{sheet.name}</SelectItem>
            ))}
          </SelectContent>
        </Select>
      </div>

      <div className="space-y-2 max-w-md mx-auto">
        {teams.map((team, idx) => {
          // Determine border color based on prefix
          const prefix = team.name.split(' ')[0];
          const borderColor = TEAM_COLORS[prefix] || '#000000';

          return (
            <Card key={team.name} style={{ border: `4px solid ${borderColor}` }}>
              <CardContent className="p-3 flex justify-between items-center">
                <div className="font-medium text-base" style={{ fontFamily: 'Poppins', fontWeight: 600 }}>
                  {idx + 1}. {team.name}
                </div>
                <div className="text-sm font-semibold" style={{ fontFamily: 'Poppins', fontWeight: 600 }}>
                  {team.score}
                </div>
              </CardContent>
            </Card>
          );
        })}
      </div>

      <div className="text-xs text-gray-400 text-center mt-8" style={{ fontFamily: 'Poppins' }}>Build #11</div>
    </div>
  );
}
